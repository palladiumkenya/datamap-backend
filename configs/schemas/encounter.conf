{"base_repository": "encounter", "query": "SELECT DISTINCT CONCAT(i.siteCode, e.patient_id) AS ClientID,                e.encounter_id                   AS EncounterId,\ne.encounter_type                  AS EncounterType, ap.date_appointment_scheduled  AS Appointment, \n      t.name                           AS ServiceType,                e.encounter_datetime             AS ActualPeriod,\n      COALESCE(d.diagnosis, '')        AS Diagnosis,                v.date_started                   AS PlannedStartDate,\n      v.date_stopped                   AS PlannedEndDate,                i.siteCode                       AS FacilityID\nFROM openmrs.encounter e         JOIN openmrs.encounter_type t ON e.encounter_type = t.encounter_type_id\nJOIN openmrs.visit v ON e.visit_id = v.visit_id         \nLEFT JOIN (SELECT d.patient_id, d.encounter_id, MAX(d.diagnosis)\n      AS diagnosis\n      FROM (SELECT d.patient_id,                                 d.encounter_id,\n      n.name                                                                       AS diagnosis,\n      ROW_NUMBER() OVER (PARTITION BY d.encounter_id ORDER BY d.date_created DESC) AS rn\n      FROM openmrs.encounter_diagnosis d\n      INNER JOIN openmrs.concept_name n ON d.diagnosis_coded = n.concept_id\n      WHERE n.locale = 'en'                            AND n.concept_name_type = 'FULLY_SPECIFIED'\n      AND d.voided = 0) d                    WHERE d.rn = 1\n      GROUP BY d.encounter_id, d.patient_id) d ON e.encounter_id = d.encounter_id and e.voided = 0\n\nleft join openmrs.patient_appointment ap on ap.start_date_time = e.encounter_datetime\n\nJOIN kenyaemr_etl.etl_default_facility_info i;", "mappings": [{"id": "3a5b720b-51fe-11f0-aef1-00090faa0001", "base_repository": "encounter", "base_variable_mapped_to": "PlannedEndDate", "tablename": "-", "columnname": "-", "datatype": "-", "join_by": "-", "created_at": "2025-06-25 22:36:42.952580", "updated_at": "2025-06-25 22:36:42.952580"}, {"id": "3a5b720c-51fe-11f0-844e-00090faa0001", "base_repository": "encounter", "base_variable_mapped_to": "ActualPeriod", "tablename": "-", "columnname": "-", "datatype": "-", "join_by": "-", "created_at": "2025-06-25 22:36:42.952580", "updated_at": "2025-06-25 22:36:42.952580"}, {"id": "3a5b720d-51fe-11f0-982c-00090faa0001", "base_repository": "encounter", "base_variable_mapped_to": "Diagnosis", "tablename": "-", "columnname": "-", "datatype": "-", "join_by": "-", "created_at": "2025-06-25 22:36:42.952580", "updated_at": "2025-06-25 22:36:42.952580"}, {"id": "3a5b720e-51fe-11f0-9021-00090faa0001", "base_repository": "encounter", "base_variable_mapped_to": "EncounterId", "tablename": "-", "columnname": "-", "datatype": "-", "join_by": "-", "created_at": "2025-06-25 22:36:42.952580", "updated_at": "2025-06-25 22:36:42.952580"}, {"id": "3a5b720f-51fe-11f0-a90c-00090faa0001", "base_repository": "encounter", "base_variable_mapped_to": "ServiceType", "tablename": "-", "columnname": "-", "datatype": "-", "join_by": "-", "created_at": "2025-06-25 22:36:42.952580", "updated_at": "2025-06-25 22:36:42.952580"}, {"id": "3a5b7210-51fe-11f0-967e-00090faa0001", "base_repository": "encounter", "base_variable_mapped_to": "PlannedStartDate", "tablename": "-", "columnname": "-", "datatype": "-", "join_by": "-", "created_at": "2025-06-25 22:36:42.952580", "updated_at": "2025-06-25 22:36:42.952580"}, {"id": "3a5b7211-51fe-11f0-b66d-00090faa0001", "base_repository": "encounter", "base_variable_mapped_to": "ClientID", "tablename": "-", "columnname": "-", "datatype": "-", "join_by": "-", "created_at": "2025-06-25 22:36:42.952580", "updated_at": "2025-06-25 22:36:42.952580"}, {"id": "3a5b7212-51fe-11f0-813f-00090faa0001", "base_repository": "encounter", "base_variable_mapped_to": "FacilityID", "tablename": "-", "columnname": "-", "datatype": "-", "join_by": "-", "created_at": "2025-06-25 22:36:42.952580", "updated_at": "2025-06-25 22:36:42.952580"}, {"id": "3a5b7213-51fe-11f0-b05a-00090faa0001", "base_repository": "encounter", "base_variable_mapped_to": "EncounterType", "tablename": "-", "columnname": "-", "datatype": "-", "join_by": "-", "created_at": "2025-06-25 22:36:42.952580", "updated_at": "2025-06-25 22:36:42.952580"}, {"id": "3a5b7214-51fe-11f0-be8c-00090faa0001", "base_repository": "encounter", "base_variable_mapped_to": "Appointment", "tablename": "-", "columnname": "-", "datatype": "-", "join_by": "-", "created_at": "2025-06-25 22:36:42.952580", "updated_at": "2025-06-25 22:36:42.952580"}]}